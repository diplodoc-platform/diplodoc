# Questions for Metapackage Documentation

This file contains follow-up questions to refine and expand the agent documentation. Please answer directly in this file.

## Architecture and Design Patterns

### 1. Extension Architecture
- Как именно extensions интегрируются с transform и cli? Есть ли общий паттерн интеграции?
- Какие есть типы extensions (plugin, runtime)? Как они отличаются?
- Как extensions регистрируются и загружаются? Есть ли система плагинов?

> В трансформе это правильнее называть подключением плагинов. Этот как раз директория plugin из экстеншенов.
> Они подключаются чарез поле options.plugins в transform(content, options)

> В CLI есть аргумент --extension или -e. Напримерр -e algolia (там мы сами проверим разные префиксы и в итоге найдем пакет @diplodoc/algolia-extension). Смотри packages/cli/src/core/program/index.ts#L261
> Так же они подключаются через .yfm конфиг.
> Есть нюанс про сразу подключенные расширения. Про него читай в ADR-001: Dependent Extensions

> Базовые знания про архитектуру extensions можно почерпнуть в docs/ru/dev.
> Хотелось бы получить сильно более подробную документацию по экстеншенам для разработчика/агентов.
> Думаю в этом месте можешь завести отдельное интервью.

### 2. Package Dependencies
- Есть ли четкие правила, какие пакеты могут зависеть от каких? (например, extensions не могут зависеть друг от друга)
- Как организованы peer dependencies? Когда их использовать?
- Как работает версионирование зависимостей между пакетами в метапакете?

> "extensions не могут зависеть друг от друга" - это возможно пока единственное негласное правило
> Еще мы не допускаем циклических зависимостей, потому что их плохо воспринимает nx.
> Про это частично написано ADR-001: Dependent Extensions

> peer dependencies используются там, где мы не должны быть завязаны на собственную версию библиотеки,
> а надеемся что библиотека будет выше по графу пакетав, а мы с ней будем совместимы

> У каждого пакета своя система версий. Нет такого, что мы синхронно апаем версию во всех пакетах.

### 3. Build Artifacts
- Что означает "зависимости через артефакты сборки"? Это означает, что пакеты должны быть собраны перед использованием?
- Как это работает в watch mode - артефакты пересобираются автоматически?

> Да, пересобираются автоматически через nx build

## Development Workflow

### 4. Watch Mode Details
- Как именно работает линковка пакетов в watch mode? Что означает "unlink non-local diplodoc packages"?
- Почему нужно unlink перед watch? Это для того, чтобы использовать локальные версии?
- Как изменения в одном пакете попадают в другой? Через workspace linking или через пересборку?

> "unlink non-local diplodoc packages" - мы удаляем директорию diplodoc из всех нодмодулей, кроме корневых
> А в корневых нодмодулях лежат не установленные из npm пакеты, а исходники из сабмодулей
> А в некорневых модулях могут как раз лежать уже предсобранные артефакты из npm, которые мешают нам подтягивать изменения из локальных пакетов. Поэтому их нужно удалить.

> workspace linking - помогает просто найти правильный подуль, а не его версию из npm. А локальная пересборка обновляет локальные артефакты.
> Так что работают оба мезанизма.

### 5. Testing Strategy
- Какие типы тестов есть на разных уровнях (unit, integration, e2e)?
- Как тестируются изменения, затрагивающие несколько пакетов?
- Есть ли стратегия тестирования для extensions?

> Тут нет однозначного ответа

### 6. Release Process
- Как происходит релиз пакетов? Все вместе или независимо?
- Как управляются версии пакетов? Есть ли синхронизация версий?
- Что происходит при breaking changes в критичных пакетах (cli, transform, components)?

> Пакеты релизятся независимо.
> Например:
> - Делаем изменения в compoments
> - Создаем ПР. Мержим его в мастер через ff-only
> - Выпускаем версию components
> - Идем в client, устанавливаем новую версию components
> - Создаем ПР. Мержим его в мастер через ff-only
> - Выпускаем версию client
> - Идем в cli, устанавливаем новую версию client
> - Создаем ПР. Мержим его в мастер через ff-only
> - Выпускаем версию cli

> При breaking changes выпускаем новую мажорную версию.
> В главных пакетах стараемся делать это редко.

## Code Quality and Standards

### 7. Linting and Formatting
- Как именно @diplodoc/lint интегрируется в пакеты? Это через npm scripts или через конфигурацию?
- Есть ли различия в linting для разных типов пакетов (extensions vs packages vs devops)?
- Как обеспечивается консистентность стиля кода между пакетами?

> @diplodoc/lint установлен как devdep. И еще прописан в prepare скриптах.
> У него есть особенность - на каждый запуск он проверяет актуальность локальной инфраструктуры. И в случае чего дозаписывает ее.
> Такой подход не дает инфраструктуре на верхнем уровне разъезжаться.
> Но вполне можно доопределить тот же eslint например на уровне src

### 8. TypeScript Configuration
- Как организованы tsconfig файлы? Есть ли базовые конфиги в devops/tsconfig?
- Как пакеты наследуют TypeScript настройки?
- Есть ли особенности компиляции для разных типов пакетов?

> Я думаю тут ты сам сможешь ответить на вопросы, если проанализируешь файлы

### 9. Documentation Standards
- Где должны храниться ADR файлы? В каждом пакете или централизованно?
- Как организована документация кода? Есть ли стандарты JSDoc?
- Как документируются публичные API пакетов?

> ADR файлы должны храниться в docs/ADR на уровне каждого сабмодуля

> Публичные API пакетов документируются силами разработчиков, когда они об этом вспоминают.
> Хотелось бы улучшить и автоматизировать это направление

## Infrastructure

### 10. CI/CD
- Какие GitHub workflows есть? Что они делают?
- Как тестируются изменения в CI? Запускаются ли тесты для всех пакетов?
- Как происходит деплой/публикация пакетов?

> Проанализируй файлы для ответа на эти вопросы

### 11. Dependency Management
- Как работает скрипт deps.js? Он обновляет зависимости во всех пакетах одновременно?
- Как решаются конфликты версий между пакетами?
- Есть ли автоматическое обновление зависимостей?

> Этот скрипт используется редко, возможно он не работает =)
> Тут бы записать TODO на его актуализацию

### 12. Nx Usage
- Какие конкретно скрипты используют Nx graph? Как они его используют?
- Как Nx помогает в разработке? Только для сборки или еще для чего-то?
- Есть ли Nx plugins или кастомные задачи?

> Nx plugins у нас никакие не подключены.
> Тут возможно ты что-то посоветуешь и добавишь в TODO

## Package-Specific Questions

### 13. Critical Packages
- **cli**: Какие основные команды? Как они организованы?
- **transform**: Как работает трансформация Markdown? Какие этапы?
- **components**: Как компоненты используются в документации? Это React компоненты?

> Это очень большие вопросы, с ними нужно разбираться через отдельные интервью.
> Не потеряй их.

### 14. Extensions
- Как extensions добавляют функциональность? Через плагины markdown-it?
- Как runtime extensions работают? Это JavaScript который выполняется в браузере?
- Есть ли общий паттерн для создания нового extension?

> Тут начни читать docs/ru/dev
> По оставшимся после этого вопросам заведи отдельное интервью

### 15. Devops Packages
- Как devops пакеты используются другими пакетами?
- Есть ли общие конфигурации, которые наследуются?
- Как devops/lint инициализируется в новых пакетах?

> Кажется эти вопросы должны проясниться из предыдущих ответов

## Remaining General Questions

### 16. Key Concepts
- Какие ключевые концепции Diplodoc должны понимать агенты? (YFM, extensions, plugins, и т.д.)
- Есть ли важные архитектурные решения или паттерны, которые используются повсеместно?

> Думаю на этот вопрос мы сможем ответить когда задокументируем все модули.
> Не потеряй его.

### 17. Code Style
- Есть ли особые требования к стилю кода, которые должны знать агенты?
- Как должны быть организованы импорты? Есть ли правила порядка?
- Есть ли паттерны именования файлов, функций, классов?

> Я бы хотел чтобы мы ориентировались на те стили, о которых догшоворились в models.
> Возможно что-то полезное про это есть в уже написанных AGENTS в openapi и cli

### 18. Error Handling
- Как обрабатываются ошибки в платформе? Есть ли общие паттерны?
- Как логируются ошибки? Есть ли централизованное логирование?

> Расскажу к чему мы движемся, но что еще не реализовано до конца:
> Тут нужно отдельно отметить CLI - она поймав ошибку логирует ее и старается продолжить свою работу, чтобы залогировать как можно больше проблем. А потом если была залогирована хоть одна ошибка, завершается с ненулевым кодом.

## Infrastructure Maintenance

### 19. Package Template
- Что именно устарело в `package-template`? Какие части инфраструктуры нужно добавить/обновить?
- Какой процесс создания нового пакета сейчас? Используется ли `package-template` или есть другой способ?
- Что должно быть в актуальном `package-template`? (lint setup, tsconfig, build scripts, etc.)

> package-template не использует diplodoc/lint это главное отличие
> Достаточно актуальная инфраструктура есть например в extensions/search-extension

---

## Instructions

Please answer these questions directly in this file. You can:
- Answer questions one by one
- Group related questions together
- Add additional context or examples
- Skip questions that are not relevant or already covered

Your answers will be used to expand and refine the agent documentation.

